admin.controller("baocaobanhangController",["$scope","$http",function(n,t){function y(){g();p();c();w();b();k();d()}function p(){t.get(e).then(function(t){t.status==200&&(n.khuvucs=t.data)})}function c(){n.khuvuc.id==null?t.get(u).then(function(t){t.status==200&&(n.bans=t.data)}):t.get(u+"?att=idKhuVuc&&value="+n.khuvuc.id).then(function(t){t.status==200&&(n.bans=t.data)})}function w(){t.get(i).then(function(t){t.status==200&&(n.khachhangs=t.data)})}function b(){t.get(h).then(function(t){t.status==200&&(n.donvitinhs=t.data)})}function k(){t.get(o).then(function(t){t.status==200&&(n.thucdons=t.data)})}function d(){t.get(s).then(function(t){t.status==200&&(n.nhanvienPhucVus=t.data)})}function g(){var t=new Date;n.filterHoaDonBanHang.denNgay=t;n.filterHoaDonBanHang.tuNgay=new Date(t.getFullYear(),t.getMonth(),1);f()}function f(){if(n.filterHoaDonBanHang.tuNgay==null||n.filterHoaDonBanHang.denNgay==null)toastr.warning("Vui lòng chọn Từ ngày - Đến ngày");else{var i=n.filterHoaDonBanHang.tuNgay,u=n.filterHoaDonBanHang.denNgay;t.get(r+"?tuNgayDay="+i.getDate()+"&&tuNgayMonth="+(i.getMonth()+1)+"&&tuNgayYear="+i.getFullYear()+"&&denNgayDay="+u.getDate()+"&&denNgayMonth="+(u.getMonth()+1)+"&&denNgayYear="+u.getFullYear()).then(function(t){t.status==200&&(n.hoadonBanHangs=t.data)})}}function l(){t.get(r+"/"+n.hoadonBanHang.id).then(function(i){i.status==200&&(n.hoadonBanHang=i.data,n.hoadonBanHang.thoigianVao=new Date(n.hoadonBanHang.thoigianVao),n.hoadonBanHang.thoigianRa=new Date(n.hoadonBanHang.thoigianRa),t.get("/HoaDonBanHang/GetChiTiet/"+n.hoadonBanHang.id).then(function(t){t.status==200&&(n.chitietHoaDonBanHangs=angular.copy(t.data.ChiTietThucDons),n.chitietNhanVienHoaDonBanHangs=angular.copy(t.data.ChiTietNhanViens))}))})}var r,a,e,u,v,o,s,h,i;n.hoadonBanHangs=[];n.hoadonBanHang={};n.selectedHoaDonBanHangs=[];n.filterHoaDonBanHang={};r="/API/ORDER_HoaDonBanHangAPI";n.chitietHoaDonBanHangs=[];n.chitietHoaDonBanhang={};a="/API/ORDER_ChiTietHoaDonBanHangAPI";n.khuvucs=[];n.khuvuc={};e="/API/DM_KhuVucAPI/";n.bans=[];n.ban={};u="/API/DM_BanAPI";n.chitietNhanVienHoaDonBanHangs=[];n.chitietNhanVienHoaDonBanHang={};v="/API/ORDER_ChiTietNhanVienHoaDonBanHangAPI";n.thucdons=[];n.thucdon={};o="/API/DM_ThucDonAPI";n.nhanvienPhucVus=[];n.nhanvienPhucVu={};n.selectedNhanVienPhucVus=[];s="/API/DM_NhanVienPhucVuAPI";n.donvitinhs=[];n.donvitinh={};h="/API/DM_DonViTinhAPI";n.khachhangs=[];n.khachhang={};i="/API/DM_KhachHangAPI";n.print={};n.print.thucdons=[];n.print.nhanviens=[];n.reviewHoaDonBanHang=!1;n.titlePopupReviewHoaDonBanHang="Hóa đơn mã "+n.hoadonBanHang.id;n.popupReviewHoaDonBanHang={width:"auto",height:"auto",contentTemplate:"templateReviewHoaDonBanHang",showTitle:!0,resizeEnabled:!0,fullScreen:!0,showCloseButton:!0,bindingOptions:{title:"titlePopupReviewHoaDonBanHang",visible:"reviewHoaDonBanHang"}};n.controlHoaDonBanHang={nhanvien:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"hoadonBanHang.nhanvien"},readOnly:!0},soKhach:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"hoadonBanHang.soKhach"},readOnly:!0},tongThoiGian:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"hoadonBanHang.tongThoiGian"},readOnly:!0},lydoHuy:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"hoadonBanHang.lydoHuy"},readOnly:!0},khachhang:{displayExpr:"ten",valueExpr:"id",searchEnabled:!0,noDataText:"Không có dữ liệu",placeholder:"Chọn ...",bindingOptions:{items:"khachhangs",value:"hoadonBanHang.idKhachHang"},readOnly:!0},thoigianVao:{type:"time",applyButtonText:"Xong",cancelButtonText:"Hủy",displayFormat:"HH:mm",bindingOptions:{value:"hoadonBanHang.thoigianVao"},readOnly:!0},thoigianRa:{type:"time",applyButtonText:"Xong",cancelButtonText:"Hủy",displayFormat:"HH:mm",bindingOptions:{value:"hoadonBanHang.thoigianRa"},readOnly:!0},ghichu:{height:40,valueChangeEvent:"keyup",bindingOptions:{value:"hoadonBanHang.ghichu"},readOnly:!0}};n.gridHoaDonBanHangs={bindingOptions:{dataSource:"hoadonBanHangs","columns[4].lookup.dataSource":"khachhangs","columns[5].lookup.dataSource":"bans"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!0,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{alignment:"center",allowEditing:!1,caption:"STT",dataField:"$id",width:70,visible:!1},{alignment:"center",allowEditing:!1,caption:"ID",dataField:"id"},{alignment:"left",caption:"Thời gian",dataField:"thoigianVao",dataType:"date",format:"dd/MM/yyyy",customizeText:function(n){return n.valueText}},{alignment:"center",allowEditing:!1,caption:"Nhân viên",dataField:"nhanvien"},{alignment:"center",caption:"Khách hàng",dataField:"idKhachHang",lookup:{displayExpr:"ten",valueExpr:"id"},visible:!0},{alignment:"center",caption:"Bàn/Phòng",dataField:"idBan",lookup:{displayExpr:"ten",valueExpr:"id"}},{alignment:"right",caption:"Tiền đồ",dataField:"tienDo",allowEditing:!1,format:{type:"fixedPoint",precision:0},visible:!0},{alignment:"right",caption:"Tiền giờ",dataField:"tienGio",allowEditing:!1,format:{type:"fixedPoint",precision:0},visible:!0},{alignment:"right",caption:"Dịch vụ",dataField:"tienNhanVien",allowEditing:!1,format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"Tổng tiền",dataField:"tongTien",allowEditing:!1,format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"Giảm",dataField:"giamTien",allowEditing:!1,format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"Thanh toán",dataField:"thanhtoan",allowEditing:!1,format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"Tiền lẻ",dataField:"tienle",allowEditing:!1,format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"Thực thu",dataField:"thucthu",allowEditing:!1,format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"Tiền vốn",dataField:"tienVon",allowEditing:!1,format:{type:"fixedPoint",precision:0}},{alignment:"left",caption:"Ghi chú",dataField:"ghichu",dataType:"string",visible:!1}],editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!0,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Báo cáo bán hàng",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!0},grouping:{contextMenuEnabled:!0,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"Kéo một cột vào đây để nhóm theo cột đó",visible:!1},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!0},hoverStateEnabled:!0,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"onClick"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"id",summaryType:"count"},],totalItems:[{column:"id",summaryType:"count"},{column:"tienDo",summaryType:"sum",valueFormat:"fixedPoint"},{column:"tienGio",summaryType:"sum",valueFormat:"fixedPoint"},{column:"tienNhanVien",summaryType:"sum",valueFormat:"fixedPoint"},{column:"tongTien",summaryType:"sum",valueFormat:"fixedPoint"},{column:"giamTien",summaryType:"sum",valueFormat:"fixedPoint"},{column:"thanhtoan",summaryType:"sum",valueFormat:"fixedPoint"},{column:"tienle",summaryType:"sum",valueFormat:"fixedPoint"},{column:"thucthu",summaryType:"sum",valueFormat:"fixedPoint"},{column:"tienVon",summaryType:"sum",valueFormat:"fixedPoint"},]},wordWrapEnabled:!1,onToolbarPreparing:function(n){var t=n.component;n.toolbarOptions.items.unshift({location:"before",widget:"dxDateBox",options:{bindingOptions:{value:"filterHoaDonBanHang.tuNgay"},type:"date",displayFormat:"dd/MM/yyyy",hint:"Từ ngày",placeholder:"Từ ngày",max:new Date}},{location:"before",widget:"dxDateBox",options:{bindingOptions:{value:"filterHoaDonBanHang.denNgay",min:"filterHoaDonBanHang.tuNgay"},type:"date",displayFormat:"dd/MM/yyyy",hint:"Đến ngày",placeholder:"Đến ngày",max:new Date}},{location:"before",widget:"dxButton",options:{hint:"Lọc",icon:"search",type:"primary",onClick:function(){f()}}},{location:"after",widget:"dxButton",options:{hint:"Load lại Dữ liệu",icon:"refresh",onClick:function(){f()}}})},onRowClick:function(t){var i=t.component;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount==1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount==2&&(new Date-i.lastClickTime<300&&(n.hoadonBanHang=angular.copy(t.data),n.ReviewHoaDonBanHang()),i.clickCount=0,i.lastClickTime=0)},onSelectionChanged:function(t){n.selectedHoaDonBanHangs=angular.copy(t.selectedRowsData)}};n.gridChiTietHoaDonBanHangs={bindingOptions:{dataSource:"chitietHoaDonBanHangs","columns[0].lookup.dataSource":"thucdons","columns[1].lookup.dataSource":"thucdons"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!1,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{caption:"Thực đơn",dataField:"idThucDon",lookup:{displayExpr:"ten",valueExpr:"id"},allowEditing:!1},{caption:"ĐVT",dataField:"idThucDon",lookup:{displayExpr:"donvitinh",valueExpr:"id"},allowEditing:!1},{alignment:"right",caption:"Đơn giá",dataField:"dongia",format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"SL",dataField:"soluong",format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"Thành tiền",dataField:"thanhtien",format:{type:"fixedPoint",precision:0},allowEditing:!1},],editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!1,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Thực đơn",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!1},grouping:{contextMenuEnabled:!1,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"Kéo một cột vào đây để nhóm theo cột đó",visible:!1},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!1},hoverStateEnabled:!1,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!1},paging:{enabled:!1,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"none"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"id",summaryType:"count"}],totalItems:[{column:"id",summaryType:"count"}]},wordWrapEnabled:!1,onRowInserted:function(){n.TinhTien()},onRowRemoved:function(){n.TinhTien()},onRowUpdated:function(){n.TinhTien()}};n.gridChiTietNhanVienHoaDonBanHangs={bindingOptions:{dataSource:"chitietNhanVienHoaDonBanHangs","columns[0].lookup.dataSource":"nhanvienPhucVus"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!1,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{caption:"Nhân viên",dataField:"idNhanVienPhucVu",lookup:{displayExpr:"ten",valueExpr:"id"},allowEditing:!1},{alignment:"right",caption:"ĐG",dataField:"dongia",format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"T/G",dataField:"thoigian",format:{type:"fixedPoint",precision:0}},{alignment:"right",caption:"Thành tiền",dataField:"thanhtien",format:{type:"fixedPoint",precision:0},allowEditing:!1},],editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!1,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Thực đơn",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!1},grouping:{contextMenuEnabled:!1,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"Kéo một cột vào đây để nhóm theo cột đó",visible:!1},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!1},hoverStateEnabled:!1,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!1},paging:{enabled:!1,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"none"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"id",summaryType:"count"}],totalItems:[{column:"id",summaryType:"count"}]},wordWrapEnabled:!1,onRowInserted:function(){n.TinhTien()},onRowRemoved:function(){n.TinhTien()},onRowUpdated:function(){n.TinhTien()}};y();n.GetAllBan=function(){n.khuvuc={};c()};n.AddKhachHang=function(){n.khachhang={};n.titlePopupModifyKhachHang="Thêm khách hàng";n.modifyKhachHang=!0};n.SaveKhachHang=function(){angular.isDefined(n.khachhang.id)?t.put(i+"/"+n.khachhang.id,n.khachhang).then(function(t){t.status==204?angular.forEach(n.khachhangs,function(t,i){t.id==n.khachhang.id&&(n.khachhangs[i]=angular.copy(n.khachhang),toastr.success("Thành công","Sửa"),n.modifyKhachHang=!1)}):toastr.error("Thất bại","Sửa")}):t.post(i,n.khachhang).then(function(t){t.status==201?(n.khachhangs.push(t.data),toastr.success("Thành công","Thêm"),n.modifyKhachHang=!1):toastr.error("Thất bại","Thêm")})};n.CancelSaveKhachHang=function(){n.modifyKhachHang=!1};n.ReviewHoaDonBanHang=function(){n.titlePopupReviewHoaDonBanHang="Hóa đơn mã "+n.hoadonBanHang.id;l();n.reviewHoaDonBanHang=!0}}]);