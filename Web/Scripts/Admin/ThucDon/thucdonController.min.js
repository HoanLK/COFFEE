admin.controller("thucdonController",["$scope","$http",function(n,t){function l(){e();r();h();y()}function e(){t.get(u).then(function(t){t.status==200&&(n.nhomThucDons=t.data)})}function r(){n.selectedNhomThucDon.id==null?t.get(i).then(function(t){t.status==200&&(n.thucdons=t.data)}):t.get(i+"?att=idNhomThucDon&&value="+n.selectedNhomThucDon.id).then(function(t){t.status==200&&(n.thucdons=t.data)})}function h(){t.get(f).then(function(t){t.status==200&&(n.donvitinhs=t.data)})}function a(){n.selectedThucDons.length>0&&(n.thucdon=angular.copy(n.selectedThucDons[0]),n.thucdon.id!=null&&t.get(o+"?att=idThucDon&&value="+n.thucdon.id).then(function(t){t.status==200&&(n.dinhluongs=t.data)}))}function v(t){var i=!1,r;angular.forEach(n.dinhluongEdits,function(n){n.idMatHang==t&&(i=!0,toastr.warning("Đã tồn tại","Mặt hàng"))});i==!1&&(r={idMatHang:t,idThucDon:n.thucdon.id,soluong:1},n.dinhluongEdits.push(r))}function y(){t.get(c).then(function(t){t.status==200&&(n.mathangs=t.data)})}var u,i,c,f,o,s;n.nhomThucDons=[];n.nhomThucDon={};n.selectedNhomThucDon={};u="/API/DM_NhomThucDonAPI";n.thucdons=[];n.thucdon={};n.selectedThucDons=[];i="/API/DM_ThucDonAPI";n.mathangs=[];n.mathang={};n.selectedMatHangs=[];c="/API/DM_MatHangAPI";n.donvitinhs=[];n.donvitinh={};f="/API/DM_DonViTinhAPI";n.dinhluongs=[];n.dinhluong={};n.dinhluongEdits=[];o="/API/KT_DinhLuongAPI";n.modifyNhomThucDon=!1;n.deleteNhomThucDon=!1;n.titlePopupModifyNhomThucDon="Thêm nhóm thực đơn";n.popupModifyNhomThucDon={width:"auto",height:"auto",contentTemplate:"templateModifyNhomThucDon",showTitle:!0,resizeEnabled:!0,bindingOptions:{title:"titlePopupModifyNhomThucDon",visible:"modifyNhomThucDon"}};n.popupDeleteNhomThucDon={width:"auto",height:"auto",contentTemplate:"templateDeleteNhomThucDon",showTitle:!1,bindingOptions:{visible:"deleteNhomThucDon"}};n.modifyThucDon=!1;n.deleteThucDon=!1;n.titlePopupModifyThucDon="Thêm thực đơn";n.popupModifyThucDon={width:"auto",height:"auto",contentTemplate:"templateModifyThucDon",showTitle:!0,resizeEnabled:!0,bindingOptions:{title:"titlePopupModifyThucDon",visible:"modifyThucDon"}};n.popupDeleteThucDon={width:"auto",height:"auto",contentTemplate:"templateDeleteThucDon",showTitle:!1,bindingOptions:{visible:"deleteThucDon"}};n.modifyDonViTinh=!1;n.titlePopupModifyDonViTinh="Thêm đơn vị tính";n.popupModifyDonViTinh={width:"auto",height:"auto",contentTemplate:"templateModifyDonViTinh",showTitle:!0,resizeEnabled:!0,bindingOptions:{title:"titlePopupModifyDonViTinh",visible:"modifyDonViTinh"}};n.modifyDinhLuong=!1;n.titlePopupModifyDinhLuong="Định lượng";n.popupModifyDinhLuong={width:"600",height:"auto",contentTemplate:"templateModifyDinhLuong",showTitle:!0,resizeEnabled:!0,bindingOptions:{title:"titlePopupModifyDinhLuong ",visible:"modifyDinhLuong"}};n.controlNhomThucDon={ten:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"nhomThucDon.ten"}}};n.controlThucDon={ten:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"thucdon.ten"}},nhomThucDon:{displayExpr:"ten",valueExpr:"id",searchEnabled:!0,noDataText:"Không có dữ liệu",placeholder:"Chọn ...",bindingOptions:{items:"nhomThucDons",value:"thucdon.idNhomThucDon"}},donvitinh:{displayExpr:"ten",valueExpr:"ten",searchEnabled:!0,noDataText:"Không có dữ liệu",placeholder:"Chọn ...",bindingOptions:{items:"donvitinhs",value:"thucdon.donvitinh"}},addNhomThucDon:{icon:"plus",onClick:function(){n.AddNhomThucDon()}},addDonViTinh:{icon:"plus",onClick:function(){n.AddDonViTinh()}}};n.controlDonViTinh={ten:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"donvitinh.ten"}}};n.listNhomThucDons={bindingOptions:{dataSource:"nhomThucDons"},height:"100%",onItemClick:function(t){n.selectedNhomThucDon=angular.copy(t.itemData);n.thucdon={};n.dinhluongs=[];r()},onItemContextMenu:function(t){n.nhomThucDon=angular.copy(t.itemData)}};n.gridThucDons={bindingOptions:{dataSource:"thucdons"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!0,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{alignment:"left",allowEditing:!1,caption:"ID",dataField:"id"},{alignment:"left",caption:"Tên thực đơn",dataField:"ten",dataType:"string"},{alignment:"left",caption:"ĐVT",dataField:"donvitinh",dataType:"string"},{alignment:"right",caption:"Giá nhập",dataField:"dongia",format:{type:"fixedPoint",precision:0}}],editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!0,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Thực đơn",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!0},grouping:{contextMenuEnabled:!0,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"THỰC ĐƠN",visible:!0},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!0},hoverStateEnabled:!0,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"onClick"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"id",summaryType:"count"}],totalItems:[{column:"id",summaryType:"count"}]},wordWrapEnabled:!1,onToolbarPreparing:function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Thêm",icon:"add",type:"success",onClick:function(){n.AddThucDon()}}},{location:"after",widget:"dxButton",options:{hint:"Sửa",icon:"edit",type:"default",onClick:function(){n.EditThucDon()}}},{location:"after",widget:"dxButton",options:{hint:"Xóa",icon:"trash",type:"danger",onClick:function(){n.DeleteThucDon()}}},{location:"after",widget:"dxButton",options:{hint:"Load lại Dữ liệu",icon:"refresh",onClick:function(){r()}}})},onRowClick:function(t){var i=t.component;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount==1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount==2&&(new Date-i.lastClickTime<300&&(n.thucdon=angular.copy(t.data),n.EditThucDon()),i.clickCount=0,i.lastClickTime=0)},onSelectionChanged:function(t){n.selectedThucDons=angular.copy(t.selectedRowsData);a()}};n.gridDinhLuongs={bindingOptions:{dataSource:"dinhluongs","columns[0].lookup.dataSource":"mathangs","columns[2].lookup.dataSource":"mathangs"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!1,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{caption:"Mặt hàng",dataField:"idMatHang",lookup:{displayExpr:"ten",valueExpr:"id"}},{alignment:"right",caption:"SL",dataField:"soluong",format:{type:"fixedPoint",precision:3}},{caption:"ĐVT",dataField:"idMatHang",lookup:{displayExpr:"donvitinh",valueExpr:"id"}},],editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!1,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Thực đơn",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!1},grouping:{contextMenuEnabled:!1,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"ĐỊNH LƯỢNG",visible:!0},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!1},hoverStateEnabled:!1,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"none"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"id",summaryType:"count"}],totalItems:[{column:"id",summaryType:"count"}]},wordWrapEnabled:!1,onToolbarPreparing:function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Định lượng",icon:"food",type:"default",onClick:function(){n.DinhLuong()}}})}};n.gridDinhLuongEdits={bindingOptions:{dataSource:"dinhluongEdits","columns[0].lookup.dataSource":"mathangs","columns[2].lookup.dataSource":"mathangs"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!1,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{caption:"Mặt hàng",dataField:"idMatHang",lookup:{displayExpr:"ten",valueExpr:"id"},allowEditing:!1},{alignment:"right",caption:"SL",dataField:"soluong",format:{type:"fixedPoint",precision:3}},{caption:"ĐVT",dataField:"idMatHang",lookup:{displayExpr:"donvitinh",valueExpr:"id"},allowEditing:!1},],editing:{mode:"cell",allowAdding:!1,allowDeleting:!0,allowUpdating:!0,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!1,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Thực đơn",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!1},grouping:{contextMenuEnabled:!1,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"Kéo một cột vào đây để nhóm theo cột đó",visible:!1},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!1},hoverStateEnabled:!1,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"none"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"id",summaryType:"count"}],totalItems:[{column:"id",summaryType:"count"}]},wordWrapEnabled:!1};n.lookupMatHangs={bindingOptions:{items:"mathangs",value:"mathang.id"},cancelButtonText:"Đóng",clearButtonText:"Xóa",displayExpr:"ten",nextButtonText:"Thêm",noDataText:"Không có dữ liệu",valueExpr:"id",title:"Chọn mặt hàng",pageLoadingText:"Đang tải...",placeholder:"Chọn mặt hàng",searchPlaceholder:"Tìm kiếm",onItemClick:function(n){v(n.itemData.id)},onClosed:function(){var n=$("#lookupMatHangs").dxLookup("instance");n.reset()}};s=[{value:"add",text:" Thêm",icon:"fa fa-plus"},{value:"edit",text:" Sửa",icon:"fa fa-pencil"},{value:"delete",text:" Xóa",icon:"fa fa-times"}];n.contextMenuNhomThucDon={dataSource:s,width:100,target:"#nhomThucDon",itemTemplate:function(n){var t=$("<div><\/div>");return n.icon&&t.append('<span class="'+n.icon+'"><span>'),t.append(n.text),t},onItemClick:function(t){if(!t.itemData.items)switch(t.itemData.value){case"add":n.AddNhomThucDon();break;case"edit":n.EditNhomThucDon();break;case"delete":n.DeleteNhomThucDon()}}};n.contextMenuThucDon={dataSource:s,width:100,target:"#thucdon",itemTemplate:function(n){var t=$("<div><\/div>");return n.icon&&t.append('<span class="'+n.icon+'"><span>'),t.append(n.text),t},onItemClick:function(t){if(!t.itemData.items)switch(t.itemData.value){case"add":n.AddThucDon();break;case"edit":n.EditThucDon();break;case"delete":n.DeleteThucDon()}}};l();n.AddNhomThucDon=function(){n.nhomThucDon={};n.titlePopupModifyNhomThucDon="Thêm nhóm thực đơn";n.modifyNhomThucDon=!0};n.EditNhomThucDon=function(){n.titlePopupModifyNhomThucDon="Sửa nhóm thực đơn";n.modifyNhomThucDon=!0};n.SaveNhomThucDon=function(){angular.isDefined(n.nhomThucDon.id)?t.put(u+"/"+n.nhomThucDon.id,n.nhomThucDon).then(function(t){t.status==204?(e(),toastr.success("Thành công","Sửa"),n.modifyNhomThucDon=!1):toastr.error("Thất bại","Sửa")}):t.post(u,n.nhomThucDon).then(function(t){t.status==201?(e(),toastr.success("Thành công","Thêm"),n.modifyNhomThucDon=!1):toastr.error("Thất bại","Thêm")})};n.CancelSaveNhomThucDon=function(){n.modifyNhomThucDon=!1};n.DeleteNhomThucDon=function(){n.deleteNhomThucDon=!0};n.ConfirmDeleteNhomThucDon=function(){t.delete(u+"/"+n.nhomThucDon.id).then(function(t){t.status==200?(e(),toastr.success("Thành công","Xóa"),n.deleteNhomThucDon=!1):toastr.error("Thất bại","Xóa")})};n.CancelDeleteNhomThucDon=function(){n.deleteNhomThucDon=!1};n.GetAllThucDon=function(){n.selectedNhomThucDon={};r()};n.AddThucDon=function(){n.thucdon={dongia:0,ton:0};n.selectedNhomThucDon.id==null||(n.thucdon.idNhomThucDon=n.selectedNhomThucDon.id);n.titlePopupModifyThucDon="Thêm thực đơn";n.modifyThucDon=!0};n.EditThucDon=function(){n.selectedThucDons.length==0?toastr.error("Chọn 1 dòng để sửa"):(n.thucdon=angular.copy(n.selectedThucDons[0]),n.titlePopupModifyThucDon="Sửa thực đơn",n.modifyThucDon=!0)};n.SaveThucDon=function(){angular.isDefined(n.thucdon.id)?t.put(i+"/"+n.thucdon.id,n.thucdon).then(function(t){t.status==204?(r(),toastr.success("Thành công","Sửa"),n.modifyThucDon=!1):toastr.error("Thất bại","Sửa")}):t.post(i,n.thucdon).then(function(t){t.status==201?(r(),toastr.success("Thành công","Thêm"),n.modifyThucDon=!1):toastr.error("Thất bại","Thêm")})};n.CancelSaveThucDon=function(){n.modifyThucDon=!1};n.DeleteThucDon=function(){n.selectedThucDons.length==0?toastr.error("Chọn dòng để xóa"):n.deleteThucDon=!0};n.ConfirmDeleteThucDon=function(){angular.forEach(n.selectedThucDons,function(r){t.delete(i+"/"+r.id).then(function(t){t.status==200?angular.forEach(n.thucdons,function(t,i){r.id===t.id&&n.thucdons.splice(i,1)}):toastr.error("Thất bại","Xóa")})});toastr.success("Thành công","Xóa");n.deleteThucDon=!1};n.CancelDeleteThucDon=function(){n.deleteThucDon=!1};n.AddDonViTinh=function(){n.donvitinh={};n.titlePopupModifyDonViTinh="Thêm đơn vị tính";n.modifyDonViTinh=!0};n.SaveDonViTinh=function(){angular.isDefined(n.donvitinh.id)?t.put(f+"/"+n.donvitinh.id,n.donvitinh).then(function(t){t.status==204?(h(),toastr.success("Thành công","Sửa"),n.modifyDonViTinh=!1):toastr.error("Thất bại","Sửa")}):t.post(f,n.donvitinh).then(function(t){t.status==201?(h(),toastr.success("Thành công","Thêm"),n.modifyDonViTinh=!1):toastr.error("Thất bại","Thêm")})};n.CancelSaveDonViTinh=function(){n.modifyDonViTinh=!1};n.DinhLuong=function(){n.thucdon.id==null?toastr.warning("Chưa chọn thực đơn","Cảnh báo"):(n.dinhluongEdits=angular.copy(n.dinhluongs),n.titlePopupModifyDinhLuong="Định lượng "+n.thucdon.ten,n.modifyDinhLuong=!0)};n.CancelSaveDinhLuong=function(){n.modifyDinhLuong=!1};n.SaveDinhLuong=function(){t.get("/DinhLuong/DeleteByThucDon/"+n.thucdon.id).then(function(i){i.status==200&&i.data==1?(angular.forEach(n.dinhluongEdits,function(n){t.post(o,n).then(function(n){console.log(n)})}),n.dinhluongs=angular.copy(n.dinhluongEdits),n.modifyDinhLuong=!1,toastr.success("Thành công","Định lượng")):toastr.error("Thất bại","Định lượng")})}}]);